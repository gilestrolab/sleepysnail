---
layout: default
title: Methods
---

<div class="jumbotron">
	<h2>My message</h2>
	</div>
<div class="row">
	<div class="col-md-6 dag_div">
		<svg
		   xmlns:dc="http://purl.org/dc/elements/1.1/"
		   xmlns:cc="http://creativecommons.org/ns#"
		   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
		   xmlns:svg="http://www.w3.org/2000/svg"
		   xmlns="http://www.w3.org/2000/svg"
		   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
		   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
		   width="300"
		   height="600"
		   id="svg2"
		   version="1.1"
		   inkscape:version="0.48.4 r9939"
		   sodipodi:docname="dag.svg">
		  <defs
			 id="defs4">
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0.0"
			   refX="0.0"
			   id="Arrow2Mend"
			   style="overflow:visible;">
			  <path
				 id="path4058"
				 style="fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;"
				 d="M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z "
				 transform="scale(0.6) rotate(180) translate(0,0)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-4"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-9"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-5"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-94"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-3"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-4"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-8"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-1"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-59"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-6"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-44"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-2"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-7"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-19"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
		  </defs>
		  <sodipodi:namedview
			 id="base"
			 pagecolor="#ffffff"
			 bordercolor="#666666"
			 borderopacity="1.0"
			 inkscape:pageopacity="0.0"
			 inkscape:pageshadow="2"
			 inkscape:zoom="1.4"
			 inkscape:cx="253.12757"
			 inkscape:cy="254.72672"
			 inkscape:document-units="px"
			 inkscape:current-layer="dag_features"
			 showgrid="false"
			 inkscape:window-width="1920"
			 inkscape:window-height="1041"
			 inkscape:window-x="1920"
			 inkscape:window-y="0"
			 inkscape:window-maximized="1" />
		  <metadata
			 id="metadata7">
			<rdf:RDF>
			  <cc:Work
				 rdf:about="">
				<dc:format>image/svg+xml</dc:format>
				<dc:type
				   rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
				<dc:title />
			  </cc:Work>
			</rdf:RDF>
		  </metadata>
		  <g
			 inkscape:label="Layer 1"
			 inkscape:groupmode="layer"
			 id="layer1"
			 transform="translate(0,-452.36218)">
			<g
			   id="g4002"
			   transform="translate(0,3.2430344e-5)">
			  <text
				 sodipodi:linespacing="100%"
				 id="text3799"
				 y="509.47589"
				 x="149.56712"
				 style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				 xml:space="preserve"><tspan
				   id="tspan3803"
				   y="509.47589"
				   x="149.56712"
				   sodipodi:role="line">Acquisition</tspan></text>
			</g>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="144.87723"
			   y="590.38031"
			   id="text3799-4"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="144.87723"
				 y="590.38031"
				 id="tspan3803-7">Sampling</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="60.392574"
			   y="661.39038"
			   id="text3799-9"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="60.392574"
				 y="661.39038"
				 id="tspan3803-1">Day/Night</tspan><tspan
				 sodipodi:role="line"
				 x="60.392574"
				 y="685.39038"
				 id="tspan3915">Classifier</tspan></text>
			<g
			   id="g3992"
			   transform="translate(-2.7144661,-15.681868)">
			  <text
				 sodipodi:linespacing="100%"
				 id="text3799-8"
				 y="677.10297"
				 x="206.78265"
				 style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				 xml:space="preserve"><tspan
				   id="tspan3803-9"
				   y="677.10297"
				   x="206.78265"
				   sodipodi:role="line">Histogram</tspan><tspan
				   id="tspan3919"
				   y="701.10297"
				   x="206.78265"
				   sodipodi:role="line">stretching</tspan></text>
			</g>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.10919"
			   y="762.97913"
			   id="text3799-83"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="204.10919"
				 y="762.97913"
				 id="tspan3803-92">Undistortion</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.53108"
			   y="834.49823"
			   id="text3799-837"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="207.85921"
				 y="834.49823"
				 id="tspan3803-8">ROI </tspan><tspan
				 sodipodi:role="line"
				 x="204.53108"
				 y="858.49823"
				 id="tspan3925">definition</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.52521"
			   y="901.90985"
			   id="text3799-7"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="204.52521"
				 y="901.90985"
				 id="tspan3803-80" /><tspan
				 sodipodi:role="line"
				 x="207.85333"
				 y="925.90985"
				 id="tspan3929">Contour </tspan><tspan
				 sodipodi:role="line"
				 x="204.52521"
				 y="949.90985"
				 id="tspan3931">extraction</tspan></text>
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_raw"
			   width="128.33707"
			   height="38.123489"
			   x="84.636871"
			   y="484.20911"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_concat"
			   width="106.04148"
			   height="42.82719"
			   x="91.622116"
			   y="562.76166"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_daynight"
			   width="116.65207"
			   height="51.652069"
			   x="3.4596794"
			   y="638.35431"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_hist"
			   width="119.45699"
			   height="57.314125"
			   x="144.52133"
			   y="638.55896"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_undist"
			   width="134.23625"
			   height="35.076687"
			   x="137.1317"
			   y="736.86267"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_rois"
			   width="116.38619"
			   height="51.066738"
			   x="146.05673"
			   y="812.70312"
			   onclick="updateDag(this.id)" />
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_contours"
			   width="116.4709"
			   height="49.636227"
			   x="146.01437"
			   y="904.83002"
			   onclick="updateDag(this.id)" />
			<g
			   id="dag_features"
			   transform="translate(45.798645,0)">
			  <text
				 sodipodi:linespacing="100%"
				 id="text3799-7-4"
				 y="992.20764"
				 x="98.293427"
				 style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				 xml:space="preserve"><tspan
				   id="tspan3803-80-2"
				   y="992.20764"
				   x="98.293427"
				   sodipodi:role="line" /><tspan
				   id="tspan3931-7"
				   y="1016.2076"
				   x="98.293427"
				   sodipodi:role="line">Features</tspan><tspan
				   id="tspan3965"
				   y="1040.2076"
				   x="98.293427"
				   sodipodi:role="line" /></text>
			  <rect
				 class="process"
				 onclick="updateDag(this.id)"
				 y="987.1178"
				 x="47.852787"
				 height="41.902348"
				 width="101.98285"
				 id="dag_raw-7-7"
				 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
			</g>
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 143.44166,528.51823 0,26.26396"
			   id="path4025"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 206.94219,702.57017 0,26.26396"
			   id="path4025-9"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 204.22773,778.07187 0,26.26396"
			   id="path4025-4"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 206.94219,870.24111 0,26.26396"
			   id="path4025-98"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 191.9606,960.89513 -17.98961,19.13555"
			   id="path4025-3"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="M 117.96876,611.6722 99.979153,630.80775"
			   id="path4025-3-5"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 171.28475,611.6722 17.98961,19.13555"
			   id="path4025-3-1"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="M 55.417346,698.52728 118.0468,979.71945"
			   id="path4025-9-7"
			   inkscape:connector-curvature="0"
			   sodipodi:nodetypes="cc" />
		  </g>
		</svg>

	</div>
	
		<div class="col-md-6">
			<div class="row fig_div">
				<div id="fig_raw" class= "process">
					<h1>Acquisition</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Representative video sequence of 18 individual land snails.</figcaption></figure></div>
				<div id="fig_concat" class= "process">
					<h1>Sampling</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Representative video sequence of 18 individual land snails.</figcaption></figure></div>
					
				<div id="fig_undist" class= "process">
					<h1>Undistortion</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Processing steps for undistorting a frame.</figcaption></figure></div>
					
				<div id="fig_daynight" class= "process">
					<h1>Day vs Night image classification.</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Summary of the classification of frames in "day" or "night" images.</figcaption></figure></div>
					
				<div id="fig_contours" class= "process">
					<h1>Active contours (snake) to define snail boundaries.</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Visual explanation of the use of morphological snake for tracking snails.</figcaption></figure></div>
				<div id="fig_rois" class= "process">
					<h1>Definition of ROIs</h1>
					<figure> <iframe width="568" height="481" frameborder="0"></iframe>
					<figcaption>Processing steps for automaticaly defining regions of interest (ROIs)</figcaption></figure></div>
<!--
					<figcaption>Representative video sequence of 18 individual land snails.</figcaption></figure></div>
					
				<div id="fig_concat" class= "process">
					<h1>Acquisition</h1>
					<iframe src="http://wl.figshare.com/articles/1041210/embed?show_title=0" width="568" height="481" frameborder="0"></iframe>
					<p>Representative video sequence of 18 individual land snails.</p>
				</div>
				<div id="fig_rois" class= "process">
					<h1>Definition of ROIs</h1>
					
					<iframe src="http://wl.figshare.com/articles/1045435/embed?show_title=0" width="568" height="481" frameborder="0"></iframe>
					<p>Processing steps for automaticaly defining regions of interest (ROIs)</p>
				</div>
				
				<div id="fig_undist" class= "process">
					<h1>Undistortion</h1>
					<iframe src="http://wl.figshare.com/articles/1045433/embed?show_title=0" width="568" height="481" frameborder="0"></iframe>
					<p>Processing steps for undistorting a frame.</p>
				</div>
				
				<div id="fig_daynight" class= "process">
					<h1>Day vs Night image classification.</h1>
					<iframe src="http://wl.figshare.com/articles/1045484/embed?show_title=0" width="568" height="481" frameborder="0"></iframe>
					<p>Summary of the classification of frames in "day" or "night" images.</p>
				</div>
				
				<div id="fig_contours" class= "process">
					<h1>Active contours (snake) to define snail boundaries.</h1>
					<iframe src="http://wl.figshare.com/articles/1041210/embed?show_title=0" width="568" height="481" frameborder="0"></iframe>
					<p>Visual explanation of the use of morphological snake for tracking snails.</p>
				</div>
-->

		
				
			</div>
		</div>
	</div>
	<div class="row math_div"> 
				
		<div id="math_raw" class= "process">
			<p>
			In each experiment, 18 land snails belonging to two common species (todo and todo) were put
			in individual tubes for several days in order to study their behaviour.
			A 12h/12h day/night cycle was applied using white and red light (which snails cannot see).
			</p>
			<p>
			Raw videos were recorded at 5 frame per second, in greyscale and at a pixel resoltion of 1240x960.
			During aquisition, videos were saved as successive sequences of 10000 frames (about 33.3 minutes) for more than five days.
			</p>
		</div>
		<div id="math_daynight" class= "process">
			<p>
			The experimental arena was set up so that periods of 12h of red light (night) and 12h of blue light (day) were succedding.
			We suspected that the onset of night and day were critical periods for snails. However, the analogu mechanism turning the lights on or off
			was not syncronised with the aquisition platform. It was therefore necessary to use the video themeselves to define the night and day periods.
			In addition, it was important to ensure no electronic failure occured and that we observed the expected night and day durations.
			</p>
			<p>
			In order to classify night and day frame, an unsupervided learning approach was undertaken.
			The median intensity as well as first and third quartiles were computed for each frames. Then kmeans clustering was applied
			to segregrate all frames in two groups according to these three variables.
			A posteriory, the cluster with the lowest centre for median intensity was defined as the "night" group.
			
			</p>
		</div>
		
		<div id="math_undist" class= "process">
			<h2>Issue with distorted images</h2>
			<p>
			Visual inspection of videos reveals that frames were slightly distorted.
			The image appears as if it was mapped onto a sphere as opose to a plan. This is known as barrel distortion.
			This artefecact results from the relatively wide angle of the camera used, and the type of lense.
			Distortion artefact could reveal problematic in later stages of the analysis in so far as it would bias morphological measurments and render 
			detection of the grid more complicated.
			</p>
			<h2>Correction of distortion</h2>
			<h3>Parameter definition</h3>
			<p>
			Classically, undistortion would require to compute a vector of distortion coeficients $\mathbf{D} = (k_1, k_2, p_1,p_2,k_3)$.
			In addition, a $3\times3$ camera matrix $\mathbf{M}$ is requiered.
			$$\mathbf{M} = \left( \begin{array}{ccc}
			f_x & 0 & c_x \\
			0 & f_y & c_y \\
			0 & 0 & 1 \end{array} \right)$$
			
			We reduce the number of parameter needed using three assumptions:
			<ul>
			<li>We can neglect tangential distortion since we know the lense is parallel to the plan.
			Therefore, we only have radial distortion, so $\mathbf{D} = (k_1, k_2, 0,0,0)$ </li>
			<li>The distortion in the $x$ and $y$ axis are equal. Therefore, $f_x = f_y = f$ and $k_1 = k_2 = k$.</li>
			<li>Finally, the distortion can be assumed to be centerd on the middle of the image. 
			Therefore, $c_x = w/2$ $c_y = h/2$ for an image of dimention $w \times h$</li>
			
			</ul>
			In the end, only $k$ and $f$ parameters need to be defined in order to undistort the image.
			</p>
			<h3>Distance function</h3>
			<p>
			The images contain parallel black lines delimiting a grid.
			We know, that these lines should be perfectly straight if the
			undistortion is sucessful.
			Therefore, it should be possible to infer $k$ and $f$ using a distance function quantifying how straight lines are in an undistorted image.
			For this distance function, <a href="http://en.wikipedia.org/wiki/Randomized_Hough_transform">probabilistic Hough transform</a> was used to discover $n$ line segments.
			Then, the distance, metric was:
			$$ D = log\left(\frac{1}{(\sum_{i}^{n}{||l_i||})}\right)$$
			where $||l_i||$ is the lenght of a line $i$.
			</p>
			<p>
				In order to improve accuraty of Hough transform, the image
				is pre-processed with a <a href=http://en.wikipedia.org/wiki/Top-hat_transform>black top-hat transform</a> 
				and binarised with automatic threshold.
			</p>
			<h3>Inference</h3>
			Brute force inference was used to locate starting parameter set candidate for subsequent minimisation of 
			distance using Nelder-Mead simplex algorithm.
			
			<h3>Result</h3>
			<p>
			The distortion was assumed to be constant in time. 
			Therefore, $k$ and $f$ were infered on the first image of each sequence and used to undistord all frames of the same sequence.
			</p>
			
		</div>
		
		<div id="math_concat" class= "process">
			<p>
				In a first place, video were trivially concatenated and resampled at one frame per minute(fpm)
				in order to simplify and speedup subsequent analysis.
				In further analysis, we assess the maximal speed of a snail in the experiement at (todo).
				Therefore, 1fpm seemed a good compromise; improving performance whist preserving relatively high-frequency information.
				It would be interesting to re-analyse the data at a higher frame rate.
				
			</p>
			<p>
				
			</p>
			
		</div>
		
		<div id="math_rois" class= "process">
			<p>
				We were interested in analysing the behaviour of snails in individual tubes.
				We therefore wanted to analyse independenlty every animal in its tube.
				During the experiment, tubes were visualy delimited by black straight lines crossing in the corners of the tube.
				This feature was used to separate each video in 18 videos (one per tube).
			</p>
			<p>
				For the first image of each video, a black top-hat was applied in order to extract the black lines.
				Then, <a href="http://en.wikipedia.org/wiki/Corner_detection#The_Harris_.26_Stephens_.2F_Plessey_.2F_Shi.E2.80.93Tomasi_corner_detection_algorithm">Harris's algorithm</a>
				was used for detecting corners.
				Random points (20% of all points) from the binary image were sampled and recorded in a sparce matrix:
				$$\mathbf{M} = \left( \begin{array}{ccc}
					x_1 & y_1\\
					x_2 & y_2\\
					\vdots & \vdots\\
					x_n & y_n \end{array} \right)$$
				
			</p>
			<p>
				<h2>Distance function</h2>
				The points can be rotated by the angle $\theta$ with:
				$$\mathbf{M'} = \mathbf{M} . \mathbf{R}^T$$
				Where
				$$\mathbf{R} = \left( \begin{array}{ccc}
					cos(\theta) & -sin(\theta)\\
					sin(\theta) & cos(\theta)\end{array} \right)$$
				Once rotated, the $x$ values of the points can be classified in four clusters (since there are four vertical lines).
				Similarly, the $y$ values are clustered in ten groups, using kmeans.
				The compactness of $x$ and $y$ clusters ($C_x$ and $C_y$, respectively) should be maximal when the rotation
				 $\hat{\theta}$ align the points.
				Therefore, a distance metric was defined as:
				$$ D = log(C_x C_y)$$
			</p>
			<h2>Inference</h2>
			<p>
				Brute force over the range $[-\pi/4, +\pi/4]$, with a resolution of $\pi 10^{-2}$ was used to estimate $\hat{\theta}$.
				Importantly, median values, $\mathbf{X}$ and $\mathbf{Y}$, for the ten $y$ and four $x$ clusters, respectively, were kept.
			</p>
			<h2>Remaping corners</h2>
				All $4 \times 10$ possible of points after rotation $\hat{\theta}$ can be expressed as:
				$$\mathbf{P} = \left( \begin{array}{ccc}
					\mathbf{X_1} & \mathbf{Y_1}\\
					\mathbf{X_2} & \mathbf{Y_1}\\
					\vdots & \vdots\\
					\mathbf{X_i} & \mathbf{Y_j} \end{array} \right)$$
				In order to remap thes points onto the unrotated image, we can trivially compute:
				
				$$\mathbf{P'} = \mathbf{P} . \mathbf{R'}^T$$
				With
				$$\mathbf{R'} = \left( \begin{array}{ccc}
					cos(-\hat{\theta}) & -sin(-\hat{\theta})\\
					sin(-\hat{\theta}) & cos(-\hat{\theta})\end{array} \right)$$
					
			<p>
				
			</p>
			
		</div>
		<div id="math_contours" class= "process">
			<h2>Overview</h2>
			<p>In this project, it was important to capture the entire shape of the animal in order to link morphological features to behavioural states.
				Importantly, the position and shape of the sensory organs of the snail, tentacles, could b...
				Although finding the approximate position of the animal is relatively trivial, finding the boundary proved difficult.
				The presence of glare and shadows casted by neighbouring snails, in addition to the variability in contrast between snails, made this task challenging.
				For each successive frame,  the following strategy was addopted:
				<ol>
				 <li>frame is pre-processed.
				 <li>the rough position (seed) of the snail is found. 
				<li> the seed was extended to the edge of the snail.
				</ol>
			</p>
			<h2>Pre-processing</h2>
			<p>Frames were denoised using Gaussian blur ($\sigma=1.5$). 
				Then, the first derivatives (on $x$ and $y$ axis) of the denoised image were computed using Sobel operator.
				The average of $x$ and $y$ derivatives were substracted from the denoised images in order to improve edges sharpness.
			</p>
			
			<h2>Seeding</h2>
			<p>
				In order to find the approximate position of each animal, a median filter ($15px$) was first applied to the preprocessed image.
				This aims was to remove low frequency variation whilst preserving the edges of the image.
				Then, greyscale morphological closing was performed ($15px$).
				Afterwards, adaptive thresholding was used to form a binary image.
				Finally, the connected components in the binary image were filtered.
			</p>
			
			<h2>Snakes</h2>
			<p>
				<a href="http://en.wikipedia.org/wiki/Active_contour_model">Active contours</a> (a.k.a. snakes) is a computer vision framework designed to
				fing the contour of a foreground object in a noisy image.
				Active contours have been used recently for segmenting biological images.
				Active contours model a physical membrane around a foreground object and try to minimise the associated energy, iteratively.
				One type of snakes, Geodesic Active Contours(GAC), 
				todo
				...
			<p>
				Recent approximation of GAC was provided through the use of morphological operators todo CITE.
				
				$$ \frac{\partial u}{\partial t} = 
					|\nabla u | \left(\mu \operatorname{div} \left(\frac{\nabla u}{|\nabla u|}\right)
					 - \nu -\lambda_1(I - c_1)^2 + \lambda_2(I - c_2)^2\right)$$
			</p>
			<p>
				In addition a <a href="http://github.com/pmneila/morphsnakes"> python implementation</a> was provided by the authors and could be used in the project with few modifications.
				The main modification was to provide a terminaison criteria.
				The iterative process would stop if the area between successive frames did not increase more than a values $\epsilon$ for four consecurive frames:
			
				Formally, convergence was defined  by 
				$$ \delta \leq \epsilon  $$
				Where,
				$$\epsilon = 10^{-5}$$
				and,
				$$ \delta =  |e_t + e_{t-2} - e_{t-1} -e_{t-3}|$$
				With
				$$ e_t = A_{t - 1} / A_{t}$$
				$A_t$ is the area of the foreground object at a descrete time $t$.
			</p>	
			<p>
				$\lambda_1$ and $\lambda_2$ define the importance of inside and outside pixels, respectively.
				Therefore, the ratio $r = \lambda_2 / \lambda_1$ is an important parameter.
				In order to find relevant value for $r$, the area of the biologial object was manually defined for ten representative pictures.
				
			</p>
		</div>

	</div>
	
</div>



