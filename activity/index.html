---
layout: default
title: Methods
---

<div class="jumbotron">
	<h2>Studying of activity pattern</h2>
	
	<p>
		<a href="../tracking">Video tracking</a> of land snails resulted in a recording of positionnal and morphological features
		of 35 snails, every minute for 140 hours. This page describes how activity was defined and
		shows graphical description of overal activity to guide an in-depth statistical analysis.
		It explains how several binomial generalised linear mixed models of activity where assessed. 
		Finally, it describes the effect of variables such as time, species and age on the propensity to be active.
	<p>
		The entire statistical analysis was done using R programing language, 
		in combination with <a href="http://cran.r-project.org/web/packages/lme4/index.html">lme4</a> package.
	</p>
	</p>
	
	</div>
<div class="row">
	<div class="col-md-6 dag_div">
			<svg
			   xmlns:dc="http://purl.org/dc/elements/1.1/"
			   xmlns:cc="http://creativecommons.org/ns#"
			   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			   xmlns:svg="http://www.w3.org/2000/svg"
			   xmlns="http://www.w3.org/2000/svg"
			   xmlns:xlink="http://www.w3.org/1999/xlink"
			   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
			   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
			   width="300"
			   height="600"
			   id="svg2"
			   version="1.1"
			   inkscape:version="0.48.4 r9939"
			   sodipodi:docname="untitled.svg">
			  <defs
				 id="defs4">
				<marker
				   inkscape:stockid="Arrow2Mend"
				   orient="auto"
				   refY="0.0"
				   refX="0.0"
				   id="Arrow2Mend"
				   style="overflow:visible;">
				  <path
					 id="path4058"
					 style="fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;"
					 d="M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z "
					 transform="scale(0.6) rotate(180) translate(0,0)" />
				</marker>
				<marker
				   inkscape:stockid="Arrow2MendTransp"
				   orient="auto"
				   refY="0.0"
				   refX="0.0"
				   id="Arrow2MendTransp"
				   style="overflow:visible;">
				  <path
					 id="path4058"
					 style="fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round; stoke-opacity:0.5;fill-opacity:0.5;"
					 d="M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z "
					 transform="scale(0.6) rotate(180) translate(0,0)" />
				</marker>
			  </defs>
			  <sodipodi:namedview
				 id="base"
				 pagecolor="#ffffff"
				 bordercolor="#666666"
				 borderopacity="1.0"
				 inkscape:pageopacity="0.0"
				 inkscape:pageshadow="2"
				 inkscape:zoom="1.4"
				 inkscape:cx="430.4534"
				 inkscape:cy="382.32051"
				 inkscape:document-units="px"
				 inkscape:current-layer="layer1"
				 showgrid="false"
				 inkscape:window-width="1920"
				 inkscape:window-height="1041"
				 inkscape:window-x="1920"
				 inkscape:window-y="0"
				 inkscape:window-maximized="1" />
			  <metadata
				 id="metadata7">
				<rdf:RDF>
				  <cc:Work
					 rdf:about="">
					<dc:format>image/svg+xml</dc:format>
					<dc:type
					   rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
					<dc:title></dc:title>
				  </cc:Work>
				</rdf:RDF>
			  </metadata>
			  <g
				 inkscape:label="Layer 1"
				 inkscape:groupmode="layer"
				 id="layer1"
				 transform="translate(0,-452.36218)">
				<a
				   xlink:href="../tracking#features">
				    <text
					   xml:space="preserve"
					   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:0.5;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
					   x="143.25868"
					   y="509.47592"
					   id="text3799"
					   sodipodi:linespacing="100%"><tspan
						 sodipodi:role="line"
						 x="143.25868"
						 y="509.47592"
						 id="tspan3803">Features</tspan></text>
						 >
						 </a>
				<path
				   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:0.5;stroke-dasharray:none;marker-end:url(#Arrow2MendTransp)"
				   d="m 143.44166,528.51823 0,26.26396"
				   id="path4025"
				   inkscape:connector-curvature="0" />
				   
				<text
				   xml:space="preserve"
				   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				   x="143.97939"
				   y="591.45178"
				   id="text3799-4"
				   sodipodi:linespacing="100%"><tspan
					 sodipodi:role="line"
					 x="143.97939"
					 y="591.45178"
					 id="tspan3803-7">Pre-processing</tspan></text>
				<text
				   xml:space="preserve"
				   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				   x="69.799118"
				   y="661.39038"
				   id="text3799-9"
				   sodipodi:linespacing="100%"><tspan
					 sodipodi:role="line"
					 x="69.799118"
					 y="661.39038"
					 id="tspan3915">Summary</tspan></text>
				<text
				   xml:space="preserve"
				   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				   x="211.80034"
				   y="663.79413"
				   id="text3799-8"
				   sodipodi:linespacing="100%"><tspan
					 sodipodi:role="line"
					 x="215.12846"
					 y="663.79413"
					 id="tspan3919">Binomial </tspan><tspan
					 id="tspan4017"
					 sodipodi:role="line"
					 x="211.80034"
					 y="687.79413">GLMMs</tspan></text>
				<text
				   xml:space="preserve"
				   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				   x="143.63954"
				   y="758.87012"
				   id="text3799-837"
				   sodipodi:linespacing="100%"><tspan
					 sodipodi:role="line"
					 x="143.63954"
					 y="758.87012"
					 id="tspan4045">Model</tspan><tspan
					 sodipodi:role="line"
					 x="143.63954"
					 y="782.87012"
					 id="tspan4049">Comparison</tspan></text>
				<text
				   xml:space="preserve"
				   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				   x="143.28798"
				   y="832.36914"
				   id="text3799-7"
				   sodipodi:linespacing="100%"><tspan
					 sodipodi:role="line"
					 x="143.28798"
					 y="832.36914"
					 id="tspan3803-80" /><tspan
					 sodipodi:role="line"
					 x="143.28798"
					 y="856.36914"
					 id="tspan3931">Model</tspan><tspan
					 sodipodi:role="line"
					 x="143.28798"
					 y="880.36914"
					 id="tspan4053">Conclusions</tspan></text>

				<a
				   xlink:href="#activity"
<!--
				   id="a3150"
				   transform="matrix(1.6533831,0,0,0.97949191,-95.686296,13.051786)">
-->
				  <rect
					 id="dag_activity"
					 class="process"
					 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
					 id="dag_concat"
					 width="106.04148"
					 height="42.82719"
					 x="91.622116"
					 y="562.76166" />
				</a>
				<a
				   xlink:href="#models"
				   id="a3162"
				   transform="matrix(1.1902533,0,0,1,-99.645274,-73.57144)">
				  <rect
					id="dag_models"
					 class="process"
					 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
					 id="dag_rois"
					 width="116.38619"
					 height="51.066738"
					 x="146.05673"
					 y="812.70312" />
				</a>
				<a
				   xlink:href="#conclusion"
				   id="a3165"
<!--
				   transform="matrix(1.1839822,0,0,1,-98.364396,-69.857146)">
-->
				  <rect
					id="dag_conclusion"
					 class="process"
					 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
					 id="dag_contours"
					 width="116.4709"
					 height="49.636227"
					 x="146.01437"
					 y="904.83002" />
				</a>

				<path
				   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
				   d="m 143.44166,798.50564 0,26.26396"
				   id="path4025-98"
				   inkscape:connector-curvature="0" />
				<a
				   xlink:href="#summary"
				   id="a3153"
				   transform="matrix(0.95851362,0,0,0.66810899,11.098156,211.86405)">
				  <rect
					 id="dag_summary"
					 class="process"
					 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
					 id="dag_daynight"
					 width="116.65207"
					 height="51.652069"
					 x="3.4596794"
					 y="638.35431" />
				</a>
				<a
				   xlink:href="#glmms"
				   id="a3156"
				   transform="translate(8.5348904,0)">
				  <rect
					id="dag_glmms"
					 class="process"
					 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
					 id="dag_hist"
					 width="119.45699"
					 height="57.314125"
					 x="144.52133"
					 y="638.55896"/>
				</a>
				<path
				   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
				   d="M 79.775563,611.6722 61.785956,630.80775"
				   id="path4025-3-5"
				   inkscape:connector-curvature="0" />
				<path
				   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
				   d="m 203.31366,611.6722 17.98961,19.13555"
				   id="path4025-3-1"
				   inkscape:connector-curvature="0" />
				<path
				   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
				   d="m 213.70478,711.53789 -17.9896,19.13555"
				   id="path4025-3-5-5"
				   inkscape:connector-curvature="0" />
			  </g>
			</svg>


	</div>
	
		<div class="col-md-6">
			<div class="row fig_div">
				<div id="fig_demo" class= "process active">
					<h1>Interact with this page</h1>
					<figure> <img src="../img/demo.png" >
					</div>
					
				<div id="fig_activity" class= "process">
					
					<h1>Data preparation and definition of the response variable
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>TODO.</figcaption></figure></div>
				
				<div id="fig_summary" class= "process">
					<h1>Summary of snail activity
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>TODO.</figcaption></figure></div>
					
				<div id="fig_glmms" class= "process">
					<h1>Using Binomial Generalised Linear Mixed Models
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>TODO.</figcaption></figure></div>

				<div id="fig_models" class= "process">
					<h1>Comparing models
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>TODO.</figcaption></figure></div>
					
				<div id="fig_conclusion" class= "process">
					<h1>Drawing conclusions from the best model
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>TODO.</figcaption></figure></div>
				
		</div>
	</div>
	<div class="row math_div" id="math"> 
		<div id="math_activity" class= "process">
		<div class="row">
			<div class="col-md-6">		
				<h2>Pre-procecessing</h2>
				<p>
				Minor preprocessing was applied to the data resulting from the tracking pipeline.
				<ol>
					<li>The first two hours of both experiments were removed to account for behavioural habituation of the animals.</li>
					<li>Median filter (with a window size of 3 minutes) was applied in order to remove potential outlier points.</li>
					<li>Linear iterpolation was applied to replace the few missing points (where the algorithm could not detect the animal).
					This also guarented the time series of features to be homogenous.</li>
					<li>Distance between consecutive $\{x,y\}$ positions was trivially computed(see exemple figure below).</li>
				</ol>
				
				</p>
				<figure> <img src="../img/speed.png"></img>
				<figcaption><em>Instantaneous speed over time for one individual.</em>
				Each point represent an instantaneous speed at a given minute for a representative animal.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				The red horizontal line represents the arbitrary threshold of activity ($1mm/min$).
				</figcaption></figure>
			</div>
			<div class="col-md-6">
				<h2>Activity</h2>
				<p>
				Instead of using speed as a measure of activity,
				we were interested in defining a binary response variable that could be a conceptual approximation
				of whether an animal is asleep at a time $t$. 
				This is an important difference, because we are more interested in the resting state of an animal
				than in its ovelall speed.
				For this reason, a snail was considered active at a given time if and only if its
				instantaneous speed was higher than $1mm/min$ (see red line on the figure). This is a provisionnal approximation which should
				be taken with caution (<a href=" ../discussion/">see discussion</a>).
				</p>
				<figure> <img src="../img/activity_one_animal.png"></img>
				<figcaption><em>Average activity per hour.</em>
				Each point represent the propotion of time during which a representative animal was active each hour of the experiment.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				
				</figcaption></figure>
			</div>
		</div>
		</div>
		
		<div id="math_summary" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Activity seem to decrease during the experiment</h2>
			<p>
				When pooling all animals and computing the average activity ratio for each hour of the experiment,
				it appears that :
				<ol>
					<li>There is a very large proportion of inactivity (rarely more than 20% of animals are active).</li>
					<li>Activity seems to decrease during experiment.</li>
				</ol>
				
				<figure> <img src="../img/activity_all_animals.png"></img>
				<figcaption><em>Average activity per hour for all animals.</em>
				Overall average of activity for all animal and every hour of both experiments.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				</figcaption></figure>
				
			</p>


			</div>
			<div class="col-md-6">	
			<h2>Snails appear to be nocturnal</h2>
			<p>
				When looking at the overall activity, snails appear to be more active during night.
				This result indicates that our experimental condition may be sufficient to promote
				differential activities between day and night.
				
				<figure> <img src="../img/zeitgeber_activ.png"></img>
				<figcaption><em>Overall average activity at different time of the day.</em>
				The overall activity was aggregated, for all animals and over time, 
				for every hour, relative to the onset of the night.
				The time  $t=0$ represents the onset of the night, and $t=12$, the onset of the day.
				</figcaption></figure>
				
			</p>

			</div>
		</div>
		</div>
		
		<div id="math_glmms" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Binomial data</h2>
			<p>
			The response variable, activity, is here assumed to be a random variable $Y$ with binary outcome (active or not active).
			Therefore, linear framework, which assumes $Y$ is normaly distributed, cannot be used.
			However, it is possible to model $Y$ in with a <em>generalised linear model</em>, with a binomial distribution.
			</p>
			
			<h2>Pseudo-replication</h2>
			<p>
			Each successive mesurment on a single snail is <em>not independant</em> from other measurment on the same animal.
			A simplified data frame coule look like:
			<figure>
			<table cellspacing="0" border="0" style="margin:auto">
				<colgroup span="3" width="85"></colgroup>
				<tr>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center"><b>Activity</b></td>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center"><b>time</b></td>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center"><b>Snail</b></td>
				</tr>
				<tr>
					<td style="border-top: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-top: 1px solid #000000" align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-top: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="0" sdnum="2057;">0</td>
					<td align="center" sdval="2" sdnum="2057;">2</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="3" sdnum="2057;">3</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="4" sdnum="2057;">4</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="5" sdnum="2057;">5</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center">…</td>
					<td align="center">…</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">…</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="0" sdnum="2057;">0</td>
					<td align="center" sdval="2" sdnum="2057;">2</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="3" sdnum="2057;">3</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="4" sdnum="2057;">4</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="5" sdnum="2057;">5</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center">…</td>
					<td style="border-bottom: 1px solid #000000" align="center">…</td>
					<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">…</td>
				</tr>
			</table>
			</figure>
			</p>
			<p>
			It would be wrong to ignore the (random) effect between each measurments of a same animal and only model fixed effects.
			The analysis of time series is a non-trivial, but one way to adress this issue is to use
			<em>generalised linear model</em> and set every individual snails as random effect.
			For instance, in R, a model could be formulated like:
			{% highlight R %}
			R> Activity ~ time + (1 | Snail)
			{% endhighlight %}
			
			</p>
			
			</div>
			<div class="col-md-6">	
			<h2>Nested Random Effects</h2>
			<p>
			In this experiment, there are, in fact, two levels of random effects.
			Indeed, two replicates (blocks) of the experiments have been produced,
			but each individual snail is only represented in one block.
			Blocks themeselve may have an (random) effect.
			It is possible to account for this hierarchical model:
			{% highlight R %}
			R> Activity ~ time + (1 | Experiment/Snail)
			{% endhighlight %}
			However, it is sometimes recomended to colapse top level random effects (block) when the level of factor is small (see <a href="http://www.sciencedirect.com/science/article/pii/S0169534709000196"> B. M. Bolker et al. 2008</a> )
			</p>
			
		</div>
		</div>
		</div>


	</div>
	
</div>



