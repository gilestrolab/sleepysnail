---
layout: default
title: Methods
---

<div class="jumbotron">
	<h2>Studying of activity pattern</h2>
	
	<p>
		<a href="../tracking">Video tracking</a> of land snails resulted in a recording of positionnal and morphological features
		of 35 snails, every minute for 140 hours. This page describes how activity was defined and
		shows graphical description of overal activity to guide an in-depth statistical analysis.
		It explains how several binomial generalised linear mixed models of activity where assessed. 
		Finally, it describes the effect of variables such as time, species and age on the propensity to be active.
	<p>
		The entire statistical analysis was done using R programing language, 
		in combination with <a href="http://cran.r-project.org/web/packages/lme4/index.html">lme4</a> package.
	</p>
	</p>
	
	</div>
<div class="row">
	<div class="col-md-6 dag_div">
		<svg
		   xmlns:dc="http://purl.org/dc/elements/1.1/"
		   xmlns:cc="http://creativecommons.org/ns#"
		   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
		   xmlns:svg="http://www.w3.org/2000/svg"
		   xmlns="http://www.w3.org/2000/svg"
		   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
		   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
		   width="300"
		   height="600"
		   id="svg2"
		   version="1.1"
		   inkscape:version="0.48.4 r9939"
		   sodipodi:docname="dag.svg">
		  <defs
			 id="defs4">
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0.0"
			   refX="0.0"
			   id="Arrow2Mend"
			   style="overflow:visible;">
			  <path
				 id="path4058"
				 style="fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;"
				 d="M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z "
				 transform="scale(0.6) rotate(180) translate(0,0)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-4"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-9"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-5"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-94"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-3"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-4"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-8"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-1"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-59"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-6"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-44"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-2"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
			<marker
			   inkscape:stockid="Arrow2Mend"
			   orient="auto"
			   refY="0"
			   refX="0"
			   id="Arrow2Mend-7"
			   style="overflow:visible">
			  <path
				 inkscape:connector-curvature="0"
				 id="path4058-19"
				 style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"
				 d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
				 transform="scale(-0.6,-0.6)" />
			</marker>
		  </defs>
		  <sodipodi:namedview
			 id="base"
			 pagecolor="#ffffff"
			 bordercolor="#666666"
			 borderopacity="1.0"
			 inkscape:pageopacity="0.0"
			 inkscape:pageshadow="2"
			 inkscape:zoom="1.4"
			 inkscape:cx="253.12757"
			 inkscape:cy="254.72672"
			 inkscape:document-units="px"
			 inkscape:current-layer="dag_features"
			 showgrid="false"
			 inkscape:window-width="1920"
			 inkscape:window-height="1041"
			 inkscape:window-x="1920"
			 inkscape:window-y="0"
			 inkscape:window-maximized="1" />
		  <metadata
			 id="metadata7">
			<rdf:RDF>
			  <cc:Work
				 rdf:about="">
				<dc:format>image/svg+xml</dc:format>
				<dc:type
				   rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
				<dc:title />
			  </cc:Work>
			</rdf:RDF>
		  </metadata>
		  <g
			 inkscape:label="Layer 1"
			 inkscape:groupmode="layer"
			 id="layer1"
			 transform="translate(0,-452.36218)">
			<g
			   id="g4002"
			   transform="translate(0,3.2430344e-5)">
			  <text
				 sodipodi:linespacing="100%"
				 id="text3799"
				 y="509.47589"
				 x="149.56712"
				 style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				 xml:space="preserve"><tspan
				   id="tspan3803"
				   y="509.47589"
				   x="149.56712"
				   sodipodi:role="line">Acquisition</tspan></text>
			</g>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="144.87723"
			   y="590.38031"
			   id="text3799-4"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="144.87723"
				 y="590.38031"
				 id="tspan3803-7">Sampling</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="60.392574"
			   y="661.39038"
			   id="text3799-9"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="60.392574"
				 y="661.39038"
				 id="tspan3803-1">Day/Night</tspan><tspan
				 sodipodi:role="line"
				 x="60.392574"
				 y="685.39038"
				 id="tspan3915">Classifier</tspan></text>
			<g
			   id="g3992"
			   transform="translate(-2.7144661,-15.681868)">
			  <text
				 sodipodi:linespacing="100%"
				 id="text3799-8"
				 y="677.10297"
				 x="206.78265"
				 style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				 xml:space="preserve"><tspan
				   id="tspan3803-9"
				   y="677.10297"
				   x="206.78265"
				   sodipodi:role="line">Histogram</tspan><tspan
				   id="tspan3919"
				   y="701.10297"
				   x="206.78265"
				   sodipodi:role="line">stretching</tspan></text>
			</g>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.10919"
			   y="762.97913"
			   id="text3799-83"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="204.10919"
				 y="762.97913"
				 id="tspan3803-92">Undistortion</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.53108"
			   y="834.49823"
			   id="text3799-837"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="207.85921"
				 y="834.49823"
				 id="tspan3803-8">ROI </tspan><tspan
				 sodipodi:role="line"
				 x="204.53108"
				 y="858.49823"
				 id="tspan3925">definition</tspan></text>
			<text
			   xml:space="preserve"
			   style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
			   x="204.52521"
			   y="901.90985"
			   id="text3799-7"
			   sodipodi:linespacing="100%"><tspan
				 sodipodi:role="line"
				 x="204.52521"
				 y="901.90985"
				 id="tspan3803-80" /><tspan
				 sodipodi:role="line"
				 x="207.85333"
				 y="925.90985"
				 id="tspan3929">Contour </tspan><tspan
				 sodipodi:role="line"
				 x="204.52521"
				 y="949.90985"
				 id="tspan3931">extraction</tspan></text>
			  <text
				sodipodi:linespacing="100%"
				id="text3799-7-4"
				y="992.20764"
				x="98.293427"
				style="font-size:24px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;line-height:100%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Liberation Sans;-inkscape-font-specification:Liberation Sans"
				xml:space="preserve"><tspan
				id="tspan3803-80-2"
				y="992.20764"
				x="98.293427"
				sodipodi:role="line" /><tspan
				id="tspan3931-7"
				y="1016.2076"
				x="98.293427"
				sodipodi:role="line">Features</tspan><tspan
				id="tspan3965"
				y="1040.2076"
				x="98.293427"
				sodipodi:role="line" /></text>
			   
			<a xlink:href="#raw">
			<rect
				class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_raw"
			   width="128.33707"
			   height="38.123489"
			   x="84.636871"
			   y="484.20911"/></a>

			<a xlink:href="#concat">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_concat"
			   width="106.04148"
			   height="42.82719"
			   x="91.622116"
			   y="562.76166" />
			 </a>
			 <a xlink:href="#daynight">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_daynight"
			   width="116.65207"
			   height="51.652069"
			   x="3.4596794"
			   y="638.35431"/>
			</a>
			 <a xlink:href="#hist">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_hist"
			   width="119.45699"
			   height="57.314125"
			   x="144.52133"
			   y="638.55896"
			   onclick="updateDag(this.id)" />
			</a>
			<a xlink:href="#undist">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_undist"
			   width="134.23625"
			   height="35.076687"
			   x="137.1317"
			   y="736.86267"
			   onclick="updateDag(this.id)" />
			</a>
			<a xlink:href="#rois">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_rois"
			   width="116.38619"
			   height="51.066738"
			   x="146.05673"
			   y="812.70312"
			   onclick="updateDag(this.id)" />
			</a>
			<a xlink:href="#contours">
			<rect
			   class="process"
			   style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
			   id="dag_contours"
			   width="116.4709"
			   height="49.636227"
			   x="146.01437"
			   y="904.83002"
			   onclick="updateDag(this.id)" />
			</a>
			
			<a xlink:href="#features">
			<rect
			 class="process"
			 onclick="updateDag(this.id)"
			 y="987.1178"
			 x="47.852787"
			 height="41.902348"
			 width="101.98285"
			 id="dag_features"
			 style="stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
			</a>
			

			
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 143.44166,528.51823 0,26.26396"
			   id="path4025"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 206.94219,702.57017 0,26.26396"
			   id="path4025-9"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 204.22773,778.07187 0,26.26396"
			   id="path4025-4"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 206.94219,870.24111 0,26.26396"
			   id="path4025-98"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 191.9606,960.89513 -17.98961,19.13555"
			   id="path4025-3"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="M 117.96876,611.6722 99.979153,630.80775"
			   id="path4025-3-5"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="m 171.28475,611.6722 17.98961,19.13555"
			   id="path4025-3-1"
			   inkscape:connector-curvature="0" />
			<path
			   style="fill:none;stroke:#000000;stroke-width:2.29999995;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend)"
			   d="M 55.417346,698.52728 118.0468,979.71945"
			   id="path4025-9-7"
			   inkscape:connector-curvature="0"
			   sodipodi:nodetypes="cc" />
		  </g>
		</svg>

	</div>
	
		<div class="col-md-6">
			<div class="row fig_div">
				<div id="fig_demo" class= "process active">
					<h1>Interact with this page</h1>
					<figure> <img src="../img/demo.png" >
					</div>
					
				<div id="fig_raw" class= "process">
					
					<h1>Acquisition
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Representative video sequence of 18 individual land snails.</figcaption></figure></div>
				<div id="fig_concat" class= "process">
					<h1>Sampling
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Representative video sequence of 18 individual land snails.</figcaption></figure></div>
				<div id="fig_hist" class= "process">
					<h1>Histogram Stretching
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>The intensity of each frame is normalised (stretched) to fix median at 128.</figcaption></figure></div>
					
				<div id="fig_undist" class= "process">
					<h1>Undistortion
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Processing steps for undistorting a frame.</figcaption></figure></div>
					
				<div id="fig_daynight" class= "process">
					<h1>Day vs Night image classification
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Summary of the classification of frames in "day" or "night" images.</figcaption></figure></div>
					
				<div id="fig_contours" class= "process">
					<h1>Active contours (snake) to define snail boundaries
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Visual explanation of the use of morphological snake for tracking snails.</figcaption></figure></div>
				<div id="fig_rois" class= "process">
					<h1>Definition of ROIs
					<button style="font-size: 50%" onClick="scrollTo('#math');">Read details</button>
					</h1>
					<figure> <div class="iframe_container"></iframe></div>
					<figcaption>Processing steps for automaticaly defining regions of interest (ROIs)</figcaption></figure></div>
			</div>
		</div>
	</div>
	<div class="row math_div" id="math"> 
		<div id="math_raw" class= "process">
		<div class="row">
			<div class="col-md-6">		
				<h2>Pre-procecessing</h2>
				<p>
				Minor preprocessing was applied to the data resulting from the tracking pipeline.
				<ol>
					<li>The first two hours of both experiments were removed to account for behavioural habituation of the animals.</li>
					<li>Median filter (with a window size of 3 minutes) was applied in order to remove potential outlier points.</li>
					<li>Linear iterpolation was applied to replace the few missing points (where the algorithm could not detect the animal).
					This also guarented the time series of features to be homogenous.</li>
					<li>Distance between consecutive $\{x,y\}$ positions was trivially computed(see exemple figure below).</li>
				</ol>
				
				</p>
				<figure> <img src="../img/speed.png"></img>
				<figcaption><em>Instantaneous speed over time for one individual.</em>
				Each point represent an instantaneous speed at a given minute for a representative animal.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				The red horizontal line represents the arbitrary threshold of activity ($1mm/min$).
				</figcaption></figure>
			</div>
			<div class="col-md-6">
				<h2>Activity</h2>
				<p>
				Instead of using speed as a measure of activity,
				we were interested in defining a binary response variable that could be a conceptual approximation
				of whether an animal is asleep at a time $t$. 
				This is an important difference, because we are more interested in the resting state of an animal
				than in its ovelall speed.
				For this reason, a snail was considered active at a given time if and only if its
				instantaneous speed was higher than $1mm/min$ (see red line on the figure). This is a provisionnal approximation which should
				be taken with caution (<a href=" ../discussion/">see discussion</a>).
				</p>
				<figure> <img src="../img/activity_one_animal.png"></img>
				<figcaption><em>Average activity per hour.</em>
				Each point represent the propotion of time during which a representative animal was active each hour of the experiment.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				
				</figcaption></figure>
			</div>
		</div>
		</div>
		
		<div id="math_concat" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Activity seem to decrease durring the experiment</h2>
			<p>
				When pooling all animals and computing the average activity ratio for each hour of the experiment,
				it appears that :
				<ol>
					<li>There is a very large proportion of inactivity (rarely more than 20% of animals are active).</li>
					<li>Activity seems to decrease during experiment.</li>
				</ol>
				
				<figure> <img src="../img/activity_all_animals.png"></img>
				<figcaption><em>Average activity per hour for all animals.</em>
				Overall average of activity for all animal and every hour of both experiments.
				The grey and black stripes on the x axis represent artificial day and night, respectively.
				</figcaption></figure>
				
			</p>


			</div>
			<div class="col-md-6">	
			<h2>Snails appear to be nocturnal</h2>
			<p>
				When looking at the overall activity, snails appear to be more active during night.
				This result indicates that our experimental condition may be sufficient to promote
				differential activities between day and night.
				
				<figure> <img src="../img/zeitgeber_activ.png"></img>
				<figcaption><em>Overall average activity at different time of the day.</em>
				The overall activity was aggregated, for all animals and over time, 
				for every hour, relative to the onset of the night.
				The time  $t=0$ represents the onset of the night, and $t=12$, the onset of the day.
				</figcaption></figure>
				
			</p>

			</div>
		</div>
		</div>
		
		<div id="math_hist" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Binomial data</h2>
			<p>
			The response variable, activity, is here assumed to be a random variable $Y$ with binary outcome (active or not active).
			Therefore, linear framework, which assumes $Y$ is normaly distributed, cannot be used.
			However, it is possible to model $Y$ in with a <em>generalised linear model</em>, with a binomial distribution.
			</p>
			
			<h2>Pseudo-replication</h2>
			<p>
			Each successive mesurment on a single snail is <em>not independant</em> from other measurment on the same animal.
			A simplified data frame coule look like:
			<figure>
			<table cellspacing="0" border="0">
				<colgroup span="3" width="85"></colgroup>
				<tr>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center"><b>Activity</b></td>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center"><b>time</b></td>
					<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center"><b>Snail</b></td>
				</tr>
				<tr>
					<td style="border-top: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-top: 1px solid #000000" align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-top: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="0" sdnum="2057;">0</td>
					<td align="center" sdval="2" sdnum="2057;">2</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="3" sdnum="2057;">3</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="4" sdnum="2057;">4</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="5" sdnum="2057;">5</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">A</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center">…</td>
					<td align="center">…</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">…</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="1" sdnum="2057;">1</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="0" sdnum="2057;">0</td>
					<td align="center" sdval="2" sdnum="2057;">2</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="3" sdnum="2057;">3</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="4" sdnum="2057;">4</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center" sdval="1" sdnum="2057;">1</td>
					<td align="center" sdval="5" sdnum="2057;">5</td>
					<td style="border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">B</td>
				</tr>
				<tr>
					<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" height="17" align="center">…</td>
					<td style="border-bottom: 1px solid #000000" align="center">…</td>
					<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000" align="center">…</td>
				</tr>
			</table>
			</figure>
			</p>
			<p>
			It would be wrong to ignore the (random) effect between each measurments of a same animal and only model fixed effects.
			The analysis of time series is a non-trivial, but one way to adress this issue is to use
			<em>generalised linear model</em> and set every individual snails as random effect.
			For instance, in R, a model could be formulated like:
			{% highlight R %}
			R> Activity ~ time + (1 | Snail)
			{% endhighlight %}
			
			</p>
			
			</div>
			<div class="col-md-6">	
			<h2>Nested Random Effects</h2>
			<p>
			In this experiment, there are, in fact, two levels of random effects.
			Indeed, two replicates (blocks) of the experiments have been produced,
			but each individual snail is only represented in one block.
			Blocks themeselve may have an (random) effect.
			It is possible to account for this hierarchical model:
			{% highlight R %}
			R> Activity ~ time + (1 | Experiment/Snail)
			{% endhighlight %}
			However, it is sometimes recomended to colapse top level random effects (block) when the level of factor is small (see <a href="http://www.sciencedirect.com/science/article/pii/S0169534709000196"> B. M. Bolker et al. 2008</a> )
			</p>
			
			</div>
		</div>
		</div>
		
		<div id="math_daynight" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Issue with day/night cycles</h2>
			<p>
				The experimental arena was set up so that periods of 12h of red light (night) and 12h of blue light (day) were succedding.
				We suspected that the onset of night and day were critical periods for snails. 
				However, the analogue mechanism controling the lights could not be syncronised accurately with the aquisition platform.
				That is the timing of the onset of the night and day was inacurate (±15min).
				We therefore decided to use the video frames themeselves to define the transitions between day and night.
				In addition, it was important to control that no electronic failures had occured.
			</p>
			<h2>Unsupervised learning</h2>
			<p>
				In order to classify night and day frame, an unsupervided learning approach was undertaken.
				The median intensity as well as first and third quartiles were computed for each frames. Then, kmeans clustering was applied
				to segregrate all frames in two groups according to these three variables.
				A posteriory, the cluster with the lowest centre for median intensity was defined as the "night" group.
				As shown in the summary figure, both clusters segregated very well and no ambiguous frames were detected.
			</p>
			</div>
			<div class="col-md-6">	
			<h2>Time drifting</h2>
			<p>
				After defining day and night frames, the time of all $day \rightarrow night$ and $night \rightarrow day$ 
				transition were computed.
					The difference between the observed and theoritical(expected) time can then be ploted against the observed time:
				<figure>
					<img src="../img/time_correction.png">
					<figcaption>
						testsdes fjkmc la vjdmal.
					</figcaption>
				</figure>
			</p>
			<p>
				If the timing was rigourously accurate, we whould observe a slope and intercept at $0$ and an $R^2$ very close to one.
				However, the overall slope is very significantly negative ($-0.67 min.h^{-1}$; $p-values &lt 2 \cdot 10^{-14}$;
				$R^2 > 0.999$). This means that the time is anticipated approximatly 16 minutes earlier every day.
				This could seriously bias biological conclusions, expectially if snails are crepuscular animals.
				Therefore, the empirical time was later used to correct the expected time stamps.
			</p>
			<p>
				The intercepts of $day \rightarrow night$ and $night \rightarrow day$ transitions are also significantly
				different frem each other.
				$(b_{night\rightarrow day} = -2.33  min$; $p-values &lt 2 \cdot 10^{-5}$).
				This indicates that, on average, 
				$night\rightarrow day$ transitions happen $2.33$ minutes after. 
				In other words, nights are $12h - 2.33min$ long (instead of $12h$), this error is therefore negligible.

			</p>
			
		</div>
		</div>
		</div>
		
		<div id="math_undist" class= "process">
		<div class="row">
			<div class="col-md-6">	
			<h2>Issue with distorted images</h2>
			<p>
			Visual inspection of videos revealed that frames were slightly distorted.
			The image appears as if it was mapped onto a sphere as opose to a plan. 
			This is known as barrel distortion.
			This artefecact results from the relatively wide angle of the camera used in combination with the type of camera lense.
			Distortion artefact could reveal problematic in later stages of the analysis in so far as it would bias morphological
			measurments and render detection of the tube layout more complicated.
			</p>
			<h2>Correction of distortion</h2>
			<h3>Parameter definition</h3>
			<p>
			Classically, undistortion would require to compute a vector of distortion coeficients $\mathbf{D} = (k_1, k_2, p_1,p_2,k_3)$.
			In addition, a $3\times3$ camera matrix, $\mathbf{M}$, is requiered:
			$$\mathbf{M} = \left( \begin{array}{ccc}
			f_x & 0 & c_x \\
			0 & f_y & c_y \\
			0 & 0 & 1 \end{array} \right)$$
			
			We were able to reduce the number of parameter needed using three assumptions:
			<ul>
			<li>We can neglect tangential distortion since we know the lense is parallel to the plan.
			Therefore, we only have radial distortion, so $\mathbf{D} = (k_1, k_2, 0,0,0)$ </li>
			<li>The distortion in the $x$ and $y$ axis are equal. Therefore, $f_x = f_y = f$ and $k_1 = k_2 = k$.</li>
			<li>Finally, the distortion can be assumed to be centerd on the middle of the image. 
			Therefore, $c_x = w/2$ and $c_y = h/2$ for an image of dimention $w \times h$</li>
			
			</ul>
			In the end, only $k$ and $f$ parameters need to be defined in order to undistort the image.
			</p>
			</div>
			<div class="col-md-6">	
			<h3>Distance function</h3>
			<p>
			The images contain black lines delimiting a grid layout around each experimental tube.
			We know, that these lines should be perfectly straight if the
			undistortion is sucessful.
			Therefore, it should be possible to infer $k$ and $f$ using a distance function quantifying how straight lines are in an undistorted image.
			Therefore, <a href="http://en.wikipedia.org/wiki/Randomized_Hough_transform">probabilistic Hough transform</a>
			was used to discover $n$ line segments.
			Then, the distance, metric was defined as:
			$$ D = log\left(\frac{1}{(\sum_{i}^{n}{||l_i||})}\right)$$
			where $||l_i||$ is the lenght of a line $i$, discovered by Hough transform.
			</p>
			<p>
				In order to improve accuraty of Hough transform, the image
				is pre-processed with a <a href=http://en.wikipedia.org/wiki/Top-hat_transform>black top-hat transform</a> 
				and binarised with automatic threshold.
			</p>
			<h3>Inference</h3>
			<p>
			Brute force inference was used to locate a candidate pair of starting parameters wich was further optimies using
			Nelder-Mead simplex algorithm.
			</p>
			<figure>
				<img src="../img/fk_landscape.png"></img>
			<figcaption>
				Exemple of distance for parameters $f$ and $k$. The black arrow indicates the "best"
				 set of parameters, $\hat{f}, \hat{k}$
			</figcaption>
			</figure>
			<p>
			The distortion was assumed to be constant in time. 
			Therefore, $k$ and $f$ were infered on the first image of each sequence and used to undistort all frames of the same sequence.
			</p>
			
		</div>
		</div>
		</div>
		

		
		<div id="math_rois" class= "process">
			<div class="row">
			<div class="col-md-6">	
			<h2>Automatic seperation of tubes</h2>
			<p>
				We were interested in analysing the behaviour of snails in individual tubes.
				We therefore wanted to analyse independenlty every animal in its tube.
				During the experiment, tubes were visualy delimited by black straight lines crossing in the corners of the tube.
				This feature was used to separate each video in 18 videos (one per tube).
			</p>
			<p>
				For the first image of each video, a black top-hat was applied in order to extract the black lines.
				Then, <a href="http://en.wikipedia.org/wiki/Corner_detection#The_Harris_.26_Stephens_.2F_Plessey_.2F_Shi.E2.80.93Tomasi_corner_detection_algorithm">Harris's algorithm</a>
				was used for detecting corners.
				Random points (20% of all points) from the binary image were sampled and recorded in a sparce matrix:
				$$\mathbf{M} = \left( \begin{array}{ccc}
					x_1 & y_1\\
					x_2 & y_2\\
					\vdots & \vdots\\
					x_n & y_n \end{array} \right)$$
				
			</p>
			<p>
				<h2>Distance function</h2>
				The points can be rotated by the angle $\theta$ with:
				$$\mathbf{M'} = \mathbf{M} . \mathbf{R}^T$$
				Where
				$$\mathbf{R} = \left( \begin{array}{ccc}
					cos(\theta) & -sin(\theta)\\
					sin(\theta) & cos(\theta)\end{array} \right)$$
				Once rotated, the $x$ values of the points can be classified in four clusters (since there are four vertical lines).
				Similarly, the $y$ values are clustered in ten groups, using kmeans.
				The compactness of $x$ and $y$ clusters ($C_x$ and $C_y$, respectively) should be maximal when the rotation
				 $\hat{\theta}$ align the points.
				Therefore, a distance metric was defined as:
				$$ D = log(C_x C_y)$$
			</p>
			</div>	
			<div class="col-md-6">	
			<h2>Inference</h2>
			<p>
				Brute force over the range $[-\pi/4, +\pi/4]$, with a resolution of $\pi 10^{-2}$ was used to estimate $\hat{\theta}$.
				Importantly, median values, $\mathbf{X}$ and $\mathbf{Y}$, for the ten $y$ and four $x$ clusters, respectively, were kept.
			</p>
			<h2>Remaping corners</h2>
				All $4 \times 10$ possible of points after rotation $\hat{\theta}$ can be expressed as:
				$$\mathbf{P} = \left( \begin{array}{ccc}
					\mathbf{X_1} & \mathbf{Y_1}\\
					\mathbf{X_2} & \mathbf{Y_1}\\
					\vdots & \vdots\\
					\mathbf{X_i} & \mathbf{Y_j} \end{array} \right)$$
				In order to remap thes points onto the unrotated image, we can trivially compute:
				
				$$\mathbf{P'} = \mathbf{P} . \mathbf{R'}^T$$
				With
				$$\mathbf{R'} = \left( \begin{array}{ccc}
					cos(-\hat{\theta}) & -sin(-\hat{\theta})\\
					sin(-\hat{\theta}) & cos(-\hat{\theta})\end{array} \right)$$
					
			<p>
				
			</p>
			
		</div>
		</div>
		</div>
		
		<div id="math_contours" class= "process">
		<div class="row">
			<div class="col-md-6">
			<h2>Overview</h2>
			<p>In this project, it was important to capture the entire shape of the animal in order to link morphological features to behavioural states.
				Importantly, the position and shape of the sensory organs of the snail, tentacles, could b...
				Although finding the approximate position of the animal is relatively trivial, finding the boundary proved difficult.
				The presence of glare and shadows casted by neighbouring snails, in addition to the variability in contrast between snails, made this task challenging.
				For each successive frame,  the following strategy was addopted:
				<ol>
				 <li>frame is pre-processed.
				 <li>the rough position (seed) of the snail is found. 
				<li> the seed was extended to the edge of the snail.
				</ol>
			</p>
			<h2>Pre-processing</h2>
			<p>Frames were denoised using Gaussian blur ($\sigma=1.5$). 
				Then, the first derivatives (on $x$ and $y$ axis) of the denoised image were computed using Sobel operator.
				The average of $x$ and $y$ derivatives were substracted from the denoised images in order to improve edges sharpness.
			</p>
			
			<h2>Seeding</h2>
			<p>
				In order to find the approximate position of each animal, a median filter ($15px$) was first applied to the preprocessed image.
				This aims was to remove low frequency variation whilst preserving the edges of the image.
				Then, greyscale morphological closing was performed ($15px$).
				Afterwards, adaptive thresholding was used to form a binary image.
				Finally, the connected components in the binary image were filtered.
			</p>
			</div>
			<div class="col-md-6">
			<h2>Snakes</h2>
			<p>
				<a href="http://en.wikipedia.org/wiki/Active_contour_model">Active contours</a> (a.k.a. snakes) is a computer vision framework designed to
				fing the contour of a foreground object in a noisy image.
				Active contours have been used recently for segmenting biological images.
				Active contours model a physical membrane around a foreground object and try to minimise the associated energy, iteratively.
				One type of snakes, Geodesic Active Contours(GAC), 
				todo
				...
			<p>
				Recent approximation of GAC was provided through the use of morphological operators todo CITE.
				
				$$ \frac{\partial u}{\partial t} = 
					|\nabla u | \left(\mu \operatorname{div} \left(\frac{\nabla u}{|\nabla u|}\right)
					 - \nu -\lambda_1(I - c_1)^2 + \lambda_2(I - c_2)^2\right)$$
			</p>
			<p>
				In addition a <a href="http://github.com/pmneila/morphsnakes"> python implementation</a> was provided by the authors and could be used in the project with few modifications.
				The main modification was to provide a terminaison criteria.
				The iterative process would stop if the area between successive frames did not increase more than a values $\epsilon$ for four consecurive frames:
			
				Formally, convergence was defined  by 
				$$ \delta \leq \epsilon  $$
				Where,
				$$\epsilon = 10^{-5}$$
				and,
				$$ \delta =  |e_t + e_{t-2} - e_{t-1} -e_{t-3}|$$
				With
				$$ e_t = A_{t - 1} / A_{t}$$
				$A_t$ is the area of the foreground object at a descrete time $t$.
			</p>	
			<p>
				$\lambda_1$ and $\lambda_2$ define the importance of inside and outside pixels, respectively.
				Therefore, the ratio $r = \lambda_2 / \lambda_1$ is an important parameter.
				In order to find relevant value for $r$, the area of the biologial object was manually defined for ten representative pictures.
				
			</p>
		</div>
		</div>
		</div>

	</div>
	
</div>



